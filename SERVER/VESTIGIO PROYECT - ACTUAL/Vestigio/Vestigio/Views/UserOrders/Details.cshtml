@model Vestigio.Models.Order

<div class="container-lg">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="display-6 mb-0">Pedido #@Model.Id</h1>
            <small class="text-muted">@Model.OrderStatus.StatusName</small>
        </div>
        <div>
            <a href="@Url.Action("Index")" class="btn btn-outline-dark">
                <i class="bi bi-arrow-left me-2"></i>Volver
            </a>
        </div>
    </div>

    <div class="row g-4">
        <!-- Información principal -->
        <div class="col-lg-4">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title mb-4">
                        <i class="bi bi-info-circle me-2"></i>Detalles del Pedido
                    </h5>
                    <dl class="row">
                        <dt class="col-sm-5">Fecha:</dt>
                        <dd class="col-sm-7">@Model.CreationDate.ToString("dd MMM yyyy HH:mm")</dd>

                        <dt class="col-sm-5">Estado:</dt>
                        <dd class="col-sm-7">
                            <span class="badge @GetStatusBadge()">
                                @Model.OrderStatus.StatusName
                            </span>
                        </dd>

                        <dt class="col-sm-5">Total:</dt>
                        <dd class="col-sm-7">@Model.Total.ToString("C")</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Datos del usuario -->
        <div class="col-lg-4">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title mb-4">
                        <i class="bi bi-person-circle me-2"></i>Datos del Cliente
                    </h5>
                    <dl class="row">
                        <dt class="col-sm-5">Nombre:</dt>
                        <dd class="col-sm-7">@Model.User.FirstName @Model.User.LastName</dd>

                        <dt class="col-sm-5">Contacto:</dt>
                        <dd class="col-sm-7">@Model.User.PhoneNumber</dd>

                        <dt class="col-sm-5">Dirección:</dt>
                        <dd class="col-sm-7">
                            @Model.User.Address, @Model.User.City (@Model.User.PostalCode)
                        </dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Acciones -->
        <div class="col-lg-4">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column justify-content-center">
                    @if (Model.OrderStatusId == 1)
                    {
                        <form method="post" asp-action="Confirm">
                            <button type="submit" class="btn btn-success w-100 btn-lg">
                                <i class="bi bi-check-circle me-2"></i>Confirmar Pedido
                            </button>
                        </form>
                    }
                    <button class="btn btn-outline-dark mt-3" onclick="window.print()">
                        <i class="bi bi-printer me-2"></i>Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Productos -->
    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <h5 class="card-title mb-4">
                <i class="bi bi-box-seam me-2"></i>Productos Solicitados
            </h5>

            <div class="table-responsive">
                <table class="table align-middle">
                    <thead>
                        <tr>
                            <th style="width: 60px"></th>
                            <th>Producto</th>
                            <th>Talla</th>
                            <th class="text-center">Cantidad</th>
                            <th class="text-end">P. Unitario</th>
                            <th class="text-end">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderDetails)
                        {
                            <tr>
                                <td>
                                    @if (item.Product.Images?.Any() == true)
                                    {
                                        <img src="@item.Product.Images.First().Url"
                                             class="img-fluid rounded"
                                             style="max-height: 50px"
                                             alt="@item.Product.Name">
                                    }
                                </td>
                                <td>
                                    <div class="fw-bold">@item.Product.Name</div>
                                    <small class="text-muted">SKU: @item.Product.Id</small>
                                </td>
                                <td>@item.ProductSize.Size</td>
                                <td class="text-center">@item.Quantity</td>
                                <td class="text-end">@item.Price.ToString("C")</td>
                                <td class="text-end fw-bold">@((item.Price * item.Quantity).ToString("C"))</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@functions {
    string GetStatusBadge()
    {
        return Model.OrderStatus.StatusName switch
        {
            "Pendiente" => "bg-warning text-dark",
            "Confirmado" => "bg-success",
            "Cancelado" => "bg-danger",
            _ => "bg-secondary"
        };
    }
}

<style>
    .card {
        border-radius: 1rem;
        transition: transform 0.2s;
    }

        .card:hover {
            transform: translateY(-3px);
        }

    dt {
        font-weight: 500;
    }
</style>